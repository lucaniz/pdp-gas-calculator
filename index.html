<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PDP Gas Calculator</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f9f9f9; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; background: #fff; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; font-size: 14px; }
    th { background: #eee; }
    input, select { width: 120px; padding: 5px; }
  </style>
</head>
<body>

<h2>Inputs</h2>
<table>
  <tr><th>Name</th><th>Value</th></tr>
  <tr><td>Deal price per TiB per month (USD)</td><td><input type="number" id="dealPrice" value="2" step="0.1" /></td></tr>
  <tr><td>FIL price (USD)</td><td><input type="number" id="filPrice" value="3" step="0.1" /></td></tr>
  <tr><td>Number of roots</td><td>
    <select id="roots">
      <option value="100">100</option>
      <option value="1000">1000</option>
      <option value="10000">10000</option>
      <option value="100000" selected>100000</option>
    </select>
  </td></tr>
  <tr><td>ProofSet size (GiB)</td><td><input type="number" id="proofSize" value="100" step="0.01" /></td></tr>
  <tr><td>Number of proofs in a day</td><td><input type="number" id="proofsPerDay" value="1" /></td></tr>
</table>

<h2>Internal Math</h2>
<table>
  <tr><th>Name</th><th>Value</th></tr>
  <tr><td>Reward per 24h per byte (USD)</td><td id="rewardUSD"></td></tr>
  <tr><td>Reward per 24h per byte (FIL)</td><td id="rewardFIL"></td></tr>
  <tr><td>Upper bound (5%), FIL</td><td id="upperBound"></td></tr>
  <tr><td>Lower Bound (4%), FIL</td><td id="lowerBound"></td></tr>
  <tr><td>1%, FIL</td><td id="onePercent"></td></tr>
</table>

<h2>Outputs</h2>
<table>
  <tr><th></th><th>High base fee</th><th>Low base fee</th><th>30d avg base fee</th></tr>
  <tr><td>Daily gas fee (FIL, all proofs)</td><td id="gasHigh"></td><td id="gasLow"></td><td id="gasAvg"></td></tr>
  <tr><td>Daily PDP proof fee (FIL, all proofs)</td><td id="pdpHigh"></td><td id="pdpLow"></td><td id="pdpAvg"></td></tr>
  <tr><td>Daily profit (FIL)</td><td id="profitHigh"></td><td id="profitLow"></td><td id="profitAvg"></td></tr>
</table>

<script>
const gasUnitsMap = {
  100: 140000000,
  1000: 150000000,
  10000: 160000000,
  100000: 170000000
};

const baseFees = {
  High: 1e-10,
  Low: 1e-16,
  Avg: 5.56e-12
};

function sci(n) {
  return Number(n).toExponential(2);
}

function calculate() {
  const dealPrice = parseFloat(document.getElementById("dealPrice").value);
  const filPrice = parseFloat(document.getElementById("filPrice").value);
  const roots = parseInt(document.getElementById("roots").value);
  const proofSize = parseFloat(document.getElementById("proofSize").value);
  const proofsPerDay = parseInt(document.getElementById("proofsPerDay").value);

  const gasUnits = gasUnitsMap[roots];
  const bytes = proofSize * 1024 ** 3;
  const rewardUSD = dealPrice / (30 * 2 ** 40);
  const rewardFIL = rewardUSD / filPrice;

  const upperBound = 0.05 * bytes * rewardFIL;
  const lowerBound = 0.04 * bytes * rewardFIL;
  const onePercent = 0.01 * bytes * rewardFIL;

  document.getElementById("rewardUSD").textContent = sci(rewardUSD);
  document.getElementById("rewardFIL").textContent = sci(rewardFIL);
  document.getElementById("upperBound").textContent = sci(upperBound);
  document.getElementById("lowerBound").textContent = sci(lowerBound);
  document.getElementById("onePercent").textContent = sci(onePercent);

  for (const tier in baseFees) {
    const baseFee = baseFees[tier];

    const gasFeeSingle = baseFee * gasUnits + 10000000 * Math.log10(gasUnits / roots);
    const gasFee = gasFeeSingle * proofsPerDay;

    let pdpFee = 0;
    if (gasFee > upperBound) {
      pdpFee = 0;
    } else if (gasFee > lowerBound) {
      pdpFee = (upperBound - gasFee) * 1; // one proof per iteration
    } else {
      pdpFee = onePercent * 1;
    }

    pdpFee *= proofsPerDay;

    const profit = rewardFIL * bytes - gasFee - pdpFee;

    document.getElementById("gas" + tier).textContent = sci(gasFee);
    document.getElementById("pdp" + tier).textContent = sci(pdpFee);
    document.getElementById("profit" + tier).textContent = sci(profit);
  }
}

document.querySelectorAll("input, select").forEach(el => {
  el.addEventListener("input", calculate);
});

calculate();
</script>

</body>
</html>

