<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PDP Gas Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
      color: #333;
    }
    h2 {
      background: #004466;
      color: white;
      padding: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
      background: white;
    }
    th, td {
      padding: 6px 10px;
      border: 1px solid #ccc;
      text-align: right;
    }
    th {
      background: #e0e0e0;
    }
    input[type="number"] {
      width: 100px;
    }
    .input-group {
      margin: 10px 0;
    }
  </style>
</head>
<body>

<h2>Inputs</h2>
<div class="input-group">
  Deal price per TiB/month (USD): <input type="number" id="dealPrice" value="2">
  FIL price (USD): <input type="number" id="filPrice" value="3">
  <br><br>
  Reward per 24h per byte (FIL): <input type="number" id="rewardFIL" value="2.02e-14" readonly>
  Reward per 24h per byte (USD): <input type="number" id="rewardUSD" value="6.06e-14" readonly>
  <br><br>
  Number of Roots: <input type="number" id="roots" value="100">
  Storage Duration (months): <input type="number" id="months" value="1">
</div>

<h2>Gas Cost Estimates</h2>
<table>
  <thead>
    <tr>
      <th>Base Fee (attoFIL)</th>
      <th>USD Cost (100 Roots)</th>
    </tr>
  </thead>
  <tbody id="gasTable">
    <!-- filled by JS -->
  </tbody>
</table>

<h2>Profit Table</h2>
<table id="resultTable">
  <thead>
    <tr>
      <th>Size</th>
      <th>Bytes</th>
      <th>PDP Fee (5%)</th>
      <th>Gas Cost (Avg)</th>
      <th>Reward (USD)</th>
      <th>Deal Income</th>
      <th>Total Profit</th>
      <th>Discount Needed</th>
    </tr>
  </thead>
  <tbody>
    <!-- filled by JS -->
  </tbody>
</table>

<script>
  const sizes = [
    { label: "1000 MiB", bytes: 1048576000 },
    { label: "10000 MiB", bytes: 10485760000 },
    { label: "32 GiB", bytes: 34359738368 },
    { label: "50 GiB", bytes: 53687091200 },
    { label: "100 GiB", bytes: 107374182400 },
    { label: "1 TiB", bytes: 1099511627776 },
    { label: "2500 GiB", bytes: 2684354560000 }
  ];

  const gasBaseFees = [1e-10, 1e-11, 1e-12, 1e-13, 1e-14, 1e-15, 1e-16];

  function calculate() {
    const dealPrice = parseFloat(document.getElementById("dealPrice").value);
    const filPrice = parseFloat(document.getElementById("filPrice").value);
    const roots = parseFloat(document.getElementById("roots").value);
    const months = parseFloat(document.getElementById("months").value);

    const rewardFIL = 2.02e-14;
    const rewardUSD = rewardFIL * filPrice;

    document.getElementById("rewardFIL").value = rewardFIL.toExponential(2);
    document.getElementById("rewardUSD").value = rewardUSD.toExponential(2);

    // Gas Fee Table
    const gasTable = document.getElementById("gasTable");
    gasTable.innerHTML = "";
    gasBaseFees.forEach(baseFee => {
      const usdCost = baseFee * 140000000 * filPrice;
      gasTable.innerHTML += `<tr>
        <td>${baseFee.toExponential(1)}</td>
        <td>${usdCost.toExponential(2)}</td>
      </tr>`;
    });

    // Result Table
    const tbody = document.getElementById("resultTable").querySelector("tbody");
    tbody.innerHTML = "";

    sizes.forEach(({ label, bytes }) => {
      const reward = rewardUSD * bytes * roots;
      const pdpFee = 0.05 * reward;
      const gasCost = 140000000 * 5.56e-12 * filPrice;
      const dealIncome = (bytes / 1099511627776) * dealPrice * months;
      const profit = reward + dealIncome - pdpFee - gasCost;

      const discountNeeded = profit < 0 ? Math.abs(profit / (reward + dealIncome)) * 100 : 0;

      tbody.innerHTML += `<tr>
        <td>${label}</td>
        <td>${bytes.toExponential(2)}</td>
        <td>${pdpFee.toExponential(2)}</td>
        <td>${gasCost.toExponential(2)}</td>
        <td>${reward.toExponential(2)}</td>
        <td>${dealIncome.toExponential(2)}</td>
        <td>${profit.toExponential(2)}</td>
        <td>${discountNeeded.toFixed(2)}%</td>
      </tr>`;
    });
  }

  calculate();
</script>

</body>
</html>

