<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDP Gas Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }
    h1 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input {
      padding: 5px;
      width: 200px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 12px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: right;
    }
    th {
      background: #f2f2f2;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    tr:nth-child(odd) {
      background: #fff;
    }
    .section-title {
      font-weight: bold;
      background: #e0e0e0;
      padding: 10px;
    }
    .chart-container {
      width: 100%;
      height: 400px;
      margin-top: 20px;
    }
  </style>
  <!-- Include Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>PDP Gas Cost & Reward Calculator</h1>

  <label>Deal price per TiB/month (USD): <input type="number" id="dealPrice" value="2"></label>
  <label>FIL price (USD): <input type="number" id="filPrice" value="3"></label>
  <label>Reward per 24h per byte (USD): <input type="number" id="rewardUSD" value="6.06e-14"></label>
  <label>Reward per 24h per byte (FIL): <input type="number" id="rewardFIL" value="2.02e-14"></label>
  <label>Number of Roots: <input type="number" id="roots" value="100"></label>
  <label>Storage Duration (months): <input type="number" id="months" value="1"></label>

  <button onclick="calculate()">Calculate</button>

  <!-- Section 1: Calculation Overview -->
  <div class="section-title">Table 1: Calculation Overview</div>
  <table id="result1">
    <thead>
      <tr>
        <th>Size</th>
        <th>Bytes</th>
        <th>PDP Fee (5%)</th>
        <th>PDP Fee (4%)</th>
        <th>PDP Fee (1%)</th>
        <th>Gas Cost (High)</th>
        <th>Gas Cost (Low)</th>
        <th>Gas Cost (Avg)</th>
        <th>Reward (USD)</th>
        <th>Deal Income</th>
        <th>% Gas / Reward</th>
        <th>% PDP / Reward</th>
        <th>Profit (High)</th>
        <th>Profit (Low)</th>
        <th>Profit (Avg)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Section 2: Discounts and Final Calculations -->
  <div class="section-title">Table 2: Summary of Discounts and Final Calculations</div>
  <table id="result2">
    <thead>
      <tr>
        <th>Discount</th>
        <th>Fee Percentage</th>
        <th>Discount Amount</th>
        <th>Net Deal Income</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Section 3: Graphs -->
  <div class="chart-container">
    <canvas id="gasCostsChart"></canvas>
  </div>
  <div class="chart-container">
    <canvas id="profitsChart"></canvas>
  </div>

  <script>
    const sizes = [
      { label: "1000 MiB", bytes: 1048576000 },
      { label: "10000 MiB", bytes: 10485760000 },
      { label: "32 GiB", bytes: 34359738368 },
      { label: "50 GiB", bytes: 53687091200 },
      { label: "100 GiB", bytes: 107374182400 },
      { label: "1 TiB", bytes: 1099511627776 },
      { label: "2500 GiB", bytes: 2684354560000 }
    ];

    let gasCostsHigh = [];
    let gasCostsLow = [];
    let gasCostsAvg = [];
    let profitsHigh = [];
    let profitsLow = [];
    let profitsAvg = [];

    function calculate() {
      const dealPrice = parseFloat(document.getElementById("dealPrice").value);
      const filPrice = parseFloat(document.getElementById("filPrice").value);
      const rewardUSD = parseFloat(document.getElementById("rewardUSD").value);
      const roots = parseFloat(document.getElementById("roots").value);
      const months = parseFloat(document.getElementById("months").value);

      const baseFees = {
        high: 1e-10,
        low: 1e-16,
        avg: 5.56e-12
      };

      const gasPer100Roots = 140000000;
      const gasPerRoot = gasPer100Roots / 100;
      const gasUsed = roots * gasPerRoot;

      const tbody1 = document.querySelector("#result1 tbody");
      tbody1.innerHTML = "";

      const tbody2 = document.querySelector("#result2 tbody");
      tbody2.innerHTML = "";

      sizes.forEach(({ label, bytes }) => {
        const reward = rewardUSD * bytes * roots;
        const fees = {
          five: 0.05 * reward,
          four: 0.04 * reward,
          one: 0.01 * reward
        };

        const gasCosts = {
          high: gasUsed * baseFees.high * filPrice,
          low: gasUsed * baseFees.low * filPrice,
          avg: gasUsed * baseFees.avg * filPrice
        };

        const dealIncome = (bytes / 1099511627776) * dealPrice * months;

        const percentGas = {
          high: (gasCosts.high / reward) * 100,
          low: (gasCosts.low / reward) * 100,
          avg: (gasCosts.avg / reward) * 100
        };

        const percentPDP = (fees.five / reward) * 100;

        const profits = {
          high: reward - fees.five - gasCosts.high,
          low: reward - fees.five - gasCosts.low,
          avg: reward - fees.five - gasCosts.avg
        };

        // Table 1 - Overview
        const row1 = `
          <tr>
            <td>${label}</td>
            <td>${bytes.toExponential(2)}</td>
            <td>${fees.five.toExponential(2)}</td>
            <td>${fees.four.toExponential(2)}</td>
            <td>${fees.one.toExponential(2)}</td>
            <td>${gasCosts.high.toExponential(2)}</td>
            <td>${gasCosts.low.toExponential(2)}</td>
            <td>${gasCosts.avg.toExponential(2)}</td>
            <td>${reward.toExponential(2)}</td>
            <td>${dealIncome.toExponential(2)}</td>
            <td>${percentGas.avg.toFixed(2)}%</td>
            <td>${percentPDP.toFixed(2)}%</td>
            <td>${profits.high.toExponential(2)}</td>
            <td>${profits.low.toExponential(2)}</td>
            <td>${profits.avg.toExponential(2)}</td>
          </tr>`;

        tbody1.insertAdjacentHTML("beforeend", row1);

        // Table 2 - Discounts and Final Calculations
        const discountRow1 = `
          <tr>
            <td>5% Fee Discount</td>
            <td>5%</td>
            <td>${fees.five.toExponential(2)}</td>
            <td>${(dealIncome - fees.five).toExponential(2)}</td>
          </tr>`;

        const discountRow2 = `
          <tr>
            <td>4% Fee Discount</td>
            <td>4%</td>
            <td>${fees.four.toExponential(2)}</td>
            <td>${(dealIncome - fees.four).toExponential(2)}</td>
          </tr>`;

        const discountRow3 = `
          <tr>
            <td>1% Fee Discount</td>
            <td>1%</td>
            <td>${fees.one.toExponential(2)}</td>
            <td>${(dealIncome - fees.one).toExponential(2)}</td>
          </tr>`;

        tbody2.insertAdjacentHTML("beforeend", discountRow1);
        tbody2.insertAdjacentHTML("beforeend", discountRow2);
        tbody2.insertAdjacentHTML("beforeend", discountRow3);

        // Prepare data for the charts
        gasCostsHigh.push(gasCosts.high);
        gasCostsLow.push(gasCosts.low);
        gasCostsAvg.push(gasCosts.avg);

        profitsHigh.push(profits.high);
        profitsLow.push(profits.low);
        profitsAvg.push(profits.avg);
      });

      // Create Gas Costs Chart
      const gasCostsChart = new Chart(document.getElementById('gasCostsChart'), {
        type: 'line',
        data: {
          labels: sizes.map(size => size.label),
          datasets: [{
            label: 'Gas Cost (High)',
            data: gasCostsHigh,
            borderColor: 'rgba(255, 99, 132, 1)',
            fill: false
          }, {
            label: 'Gas Cost (Low)',
            data: gasCostsLow,
            borderColor: 'rgba(54, 162, 235, 1)',
            fill: false
         }, {
            label: 'Gas Cost (Avg)',
            data: gasCostsAvg,
            borderColor: 'rgba(75, 192, 192, 1)',
            fill: false
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: {
              title: {
                display: true,
                text: 'Storage Size'
              }
            },
            y: {
              title: {
                display: true,
                text: 'Cost (USD)'
              }
            }
          }
        }
      });

      // Create Profits Chart
      const profitsChart = new Chart(document.getElementById('profitsChart'), {
        type: 'line',
        data: {
          labels: sizes.map(size => size.label),
          datasets: [{
            label: 'Profit (High)',
            data: profitsHigh,
            borderColor: 'rgba(153, 102, 255, 1)',
            fill: false
          }, {
            label: 'Profit (Low)',
            data: profitsLow,
            borderColor: 'rgba(255, 159, 64, 1)',
            fill: false
          }, {
            label: 'Profit (Avg)',
            data: profitsAvg,
            borderColor: 'rgba(255, 206, 86, 1)',
            fill: false
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: {
              title: {
                display: true,
                text: 'Storage Size'
              }
            },
            y: {
              title: {
                display: true,
                text: 'Profit (USD)'
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
