<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PDP Gas Cost & Reward Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input {
      padding: 6px;
      width: 300px;
      margin-top: 4px;
    }
    input[readonly] {
      background-color: #e0e0e0;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 12px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: right;
    }
    th {
      background: #eee;
    }
  </style>
</head>
<body>

<h1>PDP Gas Cost & Reward Calculator</h1>

<label>Deal price per TiB/month (USD):
  <input type="number" id="dealPrice" value="2" />
</label>

<label>FIL price (USD):
  <input type="number" id="filPrice" value="3" oninput="updateRewardFIL()" />
</label>

<label>Reward per 24h per byte (USD):
  <input type="number" id="rewardUSD" value="6.06e-14" oninput="updateRewardFIL()" />
</label>

<label>Reward per 24h per byte (FIL):
  <input type="text" id="rewardFIL" readonly />
</label>

<label>Number of Roots:
  <input type="number" id="roots" value="100" />
</label>

<label>Storage Duration (months):
  <input type="number" id="months" value="1" />
</label>

<button onclick="calculate()">Calculate</button>

<table id="result">
  <thead>
    <tr>
      <th>Size</th>
      <th>Bytes</th>
      <th>PDP Fee (5%)</th>
      <th>PDP Fee (4%)</th>
      <th>PDP Fee (1%)</th>
      <th>Gas Cost (High)</th>
      <th>Gas Cost (Low)</th>
      <th>Gas Cost (Avg)</th>
      <th>Reward (USD)</th>
      <th>Deal Income</th>
      <th>% Gas / Reward</th>
      <th>% PDP / Reward</th>
      <th>Profit (High)</th>
      <th>Profit (Low)</th>
      <th>Profit (Avg)</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const sizes = [
    { label: "1000 MiB", bytes: 1048576000 },
    { label: "10000 MiB", bytes: 10485760000 },
    { label: "32 GiB", bytes: 34359738368 },
    { label: "50 GiB", bytes: 53687091200 },
    { label: "100 GiB", bytes: 107374182400 },
    { label: "1 TiB", bytes: 1099511627776 },
    { label: "2500 GiB", bytes: 2684354560000 }
  ];

  function updateRewardFIL() {
    const filPrice = parseFloat(document.getElementById("filPrice").value);
    const rewardUSD = parseFloat(document.getElementById("rewardUSD").value);

    if (!isNaN(filPrice) && filPrice !== 0 && !isNaN(rewardUSD)) {
      const rewardFIL = rewardUSD / filPrice;
      document.getElementById("rewardFIL").value = rewardFIL.toExponential(4);
    } else {
      document.getElementById("rewardFIL").value = "";
    }
  }

  function calculate() {
    const dealPrice = parseFloat(document.getElementById("dealPrice").value);
    const filPrice = parseFloat(document.getElementById("filPrice").value);
    const rewardUSD = parseFloat(document.getElementById("rewardUSD").value);
    const roots = parseFloat(document.getElementById("roots").value);
    const months = parseFloat(document.getElementById("months").value);

    const baseFees = {
      high: 1e-10,
      low: 1e-16,
      avg: 5.56e-12
    };

    const gasPer100Roots = 140000000;
    const gasPerRoot = gasPer100Roots / 100;
    const gasUsed = roots * gasPerRoot;

    const tbody = document.querySelector("#result tbody");
    tbody.innerHTML = "";

    sizes.forEach(({ label, bytes }) => {
      const reward = rewardUSD * bytes * roots;
      const fees = {
        five: 0.05 * reward,
        four: 0.04 * reward,
        one: 0.01 * reward
      };

      const gasCosts = {
        high: gasUsed * baseFees.high * filPrice,
        low: gasUsed * baseFees.low * filPrice,
        avg: gasUsed * baseFees.avg * filPrice
      };

      const dealIncome = (bytes / 1099511627776) * dealPrice * months;

      const percentGas = {
        high: (gasCosts.high / reward) * 100,
        low: (gasCosts.low / reward) * 100,
        avg: (gasCosts.avg / reward) * 100
      };

      const percentPDP = (fees.five / reward) * 100;

      const profits = {
        high: reward - fees.five - gasCosts.high,
        low: reward - fees.five - gasCosts.low,
        avg: reward - fees.five - gasCosts.avg
      };

      const row = `
        <tr>
          <td>${label}</td>
          <td>${bytes.toExponential(2)}</td>
          <td>${fees.five.toExponential(2)}</td>
          <td>${fees.four.toExponential(2)}</td>
          <td>${fees.one.toExponential(2)}</td>
          <td>${gasCosts.high.toExponential(2)}</td>
          <td>${gasCosts.low.toExponential(2)}</td>
          <td>${gasCosts.avg.toExponential(2)}</td>
          <td>${reward.toExponential(2)}</td>
          <td>${dealIncome.toExponential(2)}</td>
          <td>${percentGas.avg.toFixed(2)}%</td>
          <td>${percentPDP.toFixed(2)}%</td>
          <td>${profits.high.toExponential(2)}</td>
          <td>${profits.low.toExponential(2)}</td>
          <td>${profits.avg.toExponential(2)}</td>
        </tr>`;
      tbody.insertAdjacentHTML("beforeend", row);
    });
  }

  // initialize rewardFIL on load
  window.onload = updateRewardFIL;
</script>

</body>
</html>
