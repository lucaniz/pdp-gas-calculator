<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PDP Gas Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f8f8;
      padding: 30px;
      line-height: 1.4;
    }

    h2 {
      margin-top: 40px;
      color: #333;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
      background: white;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 6px 8px;
      text-align: right;
      font-size: 12px;
    }

    th {
      background: #f0f0f0;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }

    input {
      padding: 4px;
      width: 200px;
      margin-bottom: 5px;
    }

    input[readonly] {
      background: #eee;
    }

    .section {
      margin-top: 30px;
      padding: 15px;
      border: 1px solid #ddd;
      background: #fff;
    }

    .half {
      display: flex;
      gap: 30px;
    }

    .half > div {
      flex: 1;
    }
  </style>
</head>
<body>

  <h1>PDP Gas Calculator (Spreadsheet Format)</h1>

  <div class="section">
    <h2>1. Core Inputs & Outputs (A6–J16)</h2>
    <div class="half">
      <div>
        <label>Deal price per TiB/month (USD): <input type="number" id="dealPrice" value="2"></label>
        <label>Total Reward in USD: <input type="number" id="totalRewardUSD" value="500" oninput="updateRewards()"></label>
        <label>FIL Price (USD): <input type="number" id="filPrice" value="3" oninput="updateRewards()"></label>
        <label>Number of Roots: <input type="number" id="roots" value="100"></label>
        <label>Storage Duration (months): <input type="number" id="months" value="1"></label>
      </div>

      <div>
        <label>Reward/24h/byte (USD): <input type="text" id="rewardUSD" readonly></label>
        <label>Reward/24h/byte (FIL): <input type="text" id="rewardFIL" readonly></label>
        <label>PDP Fee %: <input type="text" value="5%" readonly></label>
        <label>Gas Used (estimated): <input type="text" id="gasUsed" readonly></label>
        <button onclick="calculate()">Calculate Table Below</button>
      </div>
    </div>
  </div>

  <div class="section">
    <h2>2. Derived Inputs & Conversion (A19–B24)</h2>
    <table>
      <tbody id="derivedInputs">
        <!-- Filled by JS -->
      </tbody>
    </table>
  </div>

  <div class="section">
    <h2>3. Size Breakdown & Results (A33–W39)</h2>
    <table id="resultTable">
      <thead>
        <tr>
          <th>Size</th>
          <th>Bytes</th>
          <th>Reward</th>
          <th>PDP Fee (5%)</th>
          <th>Deal Income</th>
          <th>Gas Cost High</th>
          <th>Gas Cost Avg</th>
          <th>Gas Cost Low</th>
          <th>% Gas / Reward</th>
          <th>% PDP / Reward</th>
          <th>Profit High</th>
          <th>Profit Avg</th>
          <th>Profit Low</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const sizes = [
      { label: "1000 MiB", bytes: 1048576000 },
      { label: "10000 MiB", bytes: 10485760000 },
      { label: "32 GiB", bytes: 34359738368 },
      { label: "50 GiB", bytes: 53687091200 },
      { label: "100 GiB", bytes: 107374182400 },
      { label: "1 TiB", bytes: 1099511627776 },
      { label: "2500 GiB", bytes: 2684354560000 }
    ];

    function updateRewards() {
      const totalUSD = parseFloat(document.getElementById("totalRewardUSD").value);
      const filPrice = parseFloat(document.getElementById("filPrice").value);
      const rewardUSD = totalUSD / (30 * Math.pow(2, 40));
      const rewardFIL = rewardUSD / filPrice;

      document.getElementById("rewardUSD").value = rewardUSD.toExponential(6);
      document.getElementById("rewardFIL").value = rewardFIL.toExponential(6);
    }

    function calculate() {
      const dealPrice = parseFloat(document.getElementById("dealPrice").value);
      const rewardUSD = parseFloat(document.getElementById("rewardUSD").value);
      const filPrice = parseFloat(document.getElementById("filPrice").value);
      const roots = parseFloat(document.getElementById("roots").value);
      const months = parseFloat(document.getElementById("months").value);

      const gasPer100Roots = 140000000;
      const gasPerRoot = gasPer100Roots / 100;
      const gasUsed = roots * gasPerRoot;
      document.getElementById("gasUsed").value = gasUsed.toLocaleString();

      const baseFees = {
        high: 1e-10,
        avg: 5.56e-12,
        low: 1e-16
      };

      // Derived Inputs (Table 2)
      const derivedHTML = `
        <tr><td>Gas per root</td><td>${gasPerRoot.toLocaleString()}</td></tr>
        <tr><td>Total gas used</td><td>${gasUsed.toLocaleString()}</td></tr>
        <tr><td>Reward/day/byte (USD)</td><td>${rewardUSD.toExponential(6)}</td></tr>
        <tr><td>Reward/day/byte (FIL)</td><td>${(rewardUSD / filPrice).toExponential(6)}</td></tr>
        <tr><td>1 TiB in bytes</td><td>${1099511627776}</td></tr>
        <tr><td>Days/month (avg)</td><td>30</td></tr>
      `;
      document.getElementById("derivedInputs").innerHTML = derivedHTML;

      // Main Table (Table 3)
      const tbody = document.querySelector("#resultTable tbody");
      tbody.innerHTML = "";

      sizes.forEach(({ label, bytes }) => {
        const reward = rewardUSD * bytes * roots;
        const pdpFee = reward * 0.05;
        const dealIncome = (bytes / 1099511627776) * dealPrice * months;

        const gasCosts = {
          high: gasUsed * baseFees.high * filPrice,
          avg: gasUsed * baseFees.avg * filPrice,
          low: gasUsed * baseFees.low * filPrice
        };

        const percentGas = {
          high: (gasCosts.high / reward) * 100,
          avg: (gasCosts.avg / reward) * 100,
          low: (gasCosts.low / reward) * 100
        };

        const profit = {
          high: reward - pdpFee - gasCosts.high,
          avg: reward - pdpFee - gasCosts.avg,
          low: reward - pdpFee - gasCosts.low
        };

        tbody.insertAdjacentHTML("beforeend", `
          <tr>
            <td>${label}</td>
            <td>${bytes.toLocaleString()}</td>
            <td>${reward.toExponential(2)}</td>
            <td>${pdpFee.toExponential(2)}</td>
            <td>${dealIncome.toExponential(2)}</td>
            <td>${gasCosts.high.toExponential(2)}</td>
            <td>${gasCosts.avg.toExponential(2)}</td>
            <td>${gasCosts.low.toExponential(2)}</td>
            <td>${percentGas.avg.toFixed(2)}%</td>
            <td>5.00%</td>
            <td>${profit.high.toExponential(2)}</td>
            <td>${profit.avg.toExponential(2)}</td>
            <td>${profit.low.toExponential(2)}</td>
          </tr>
        `);
      });
    }

    window.onload = updateRewards;
  </script>
</body>
</html>
